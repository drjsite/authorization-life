# 用户登录及注册技术设计

### 文档版本控制

- Created: 2022年12月21日
- Tags: 技术设计
- 版本: v1

| 修订者 | 版本    | 备注 |
|-----|:------|:---|
| 王俊明 | 1.0.0 |    |
|     |       |    |

## 用户管理(平台级)

### 功能概述

本功能提供用户管理的登录注册,用户审核,租户client的申请,密码重置

相关参考:

https://blog.csdn.net/u013737132/article/details/134024381

### 表设计

```sql

```

### 接口设计

#### client信息(✔)

> POST /oauth/client

- 功能描述: 通过浏览器地址中的域名获取client客户端信息, 包含 client_id, client_secret
- domain: 根据域名查询登录时使用的client信息, 其域名包含测试域名,正式域名, 比如: dev.authorization.life,
  test.authorization.life, dev-api.authorization.life等.

#### 发送邮箱注册验证码

> POST /oauth/send-email-code

- 接收邮箱, 并验证邮箱的格式, 存储至redis中验证码,有效期为十分钟, 十分钟内的验证码是有效的, 十分钟内可以验证通过.

#### 用户邮箱注册

> POST /oauth/email-register

- 功能描述: 接收邮箱或手机号码, 使用消息服务异步的发送邮箱验证码或手机验证码消息.
- email: 邮箱, 则给邮箱发送验证码, 填写验证码并验证通过后, 此邮箱则被验证通过.
- phone: 手机号码, 则给手机号发送验证码, 填写验证码并验证通过后, 此手机号被验证通过.
- 邮箱验证码: 大写字母+数字的 6个 字符.
- 手机号验证码: 纯数字 6位 数字 .
- 在验证通过后, 填写 用户名, 填写登录密码.

#### 发送邮箱重置密码验证码

> POST /oauth/send-email-code-reset-pwd

- 接收邮箱, 并验证邮箱的格式, 存储至redis中验证码,有效期为十分钟, 十分钟内的验证码是有效的, 十分钟内可以验证通过.

#### 用户重置密码

> POST /oauth/reset-password

- 验证验证码是否正确, 确认密码是否正确.

#### 获取当前登录用户信息

> GET /oauth/self-user

- 通过请求头中的accessToken解析用户信息

#### 获取验证码图片

> GET /oauth/valid-picture-code

- 在输入错误密码3次, 需要弹出图片验证码进行输入图片中的验证码.

#### 发送手机登录验证码

> GET /oauth/send-sms-code-login

- 接收手机号, 并验证手机号的位数, 存储至redis中验证码,有效期为十分钟, 十分钟内的验证码是有效的, 十分钟内可以验证通过.

#### 发送手机登录验证码

> GET /oauth/send-email-code-login

- 接收手机号, 并验证手机号的位数, 存储至redis中验证码,有效期为十分钟, 十分钟内的验证码是有效的, 十分钟内可以验证通过.

#### 用户审核通过

> POST /v1/user/user-approved

- 接受用户编码(字段: username), 查询是否存在于系统中, 如果存在则更新 activedFlag 值为 true.

#### 用户审核拒绝

> POST /v1/user/user-audit-reject

- 接受用户编码(字段: username), 查询是否存在于系统中, 如果存在则更新 activedFlag 值为 false.

#### 用户解锁

> POST /v1/user/user-unlock

- 接受用户编码(字段: username), 查询是否存在于系统中, 如果存在则更新 lockedFlag 值为 false.

### 常量定义

| 字段 | 值 | 含义 |
|----|:--|:---|
|    |   |    |

### 值定义

| 值说明 | key | value |
|-----|:----|:------|
|     |     |       |

### 备注

## 问题记录
