# 用户权限技术设计

### 文档版本控制

- Created: 2023年02月27日
- Tags: 技术设计
- 版本: v1

| 修订者 | 版本    | 备注 |
|-----|:------|:---|
| 王俊明 | 1.0.0 |    |
|     |       |    |

## 员工权限管理(平台级)

### 功能概述

##### 参考 linux系统的用户权限作对比, 以此为出发点, 进而延伸出多租户的权限设计.

###### 此为 抛"砖"引玉.

###### 租户体系层级:

租户->组织/法律实体->部门->岗位->员工

###### 前提:

1. 用户可以关联多个租户, 即 用户可以关联多个 员工.
2. 每一个租户都是一个顶级的角色, 此顶级角色作为此租户的管理员, 此租户的新员工的所有权限都继承自此管理员

##### 相关参考

saas系统权限设计: [https://mp.weixin.qq.com/s/4Bb3YqM7LXUQE0ThL2Fwqw](https://mp.weixin.qq.com/s/4Bb3YqM7LXUQE0ThL2Fwqw)

linux文件系统权限: [https://www.cnblogs.com/songgj/p/8890710.html](https://www.cnblogs.com/songgj/p/8890710.html)

### 对比

#### 用户与角色

| 序号 | linu系统用户组           | sass系统用户角色            |
|----|:--------------------|:----------------------|
|    | root(顶级用户)          | system_admin(顶级角色)    |
|    | create_user(新创建的用户) | create_user(新注册的角色)   |
|    | other_user(别的用户)    | anonymous_user(匿名的角色) |
|    | zhangsan(指定用户)      | admin_user(普通的管理员的角色) |

#### 文件类型与资源类型

| 序号 | linux系统的文件类型                                     | saas系统的资源类型 |
|----|:-------------------------------------------------|:------------|
| 1  | -：普通文件                                           | button: 按钮  |
| 2  | d：目录文件                                           | api: 请求接口   |
| 3  | l：软链接（类似Windows的快捷方式）                            | menu: 模块/菜单 |
| 4  | b：块设备文件（例如硬盘、光驱等）                                |             |
| 5  | p：管道文件                                           |             |
| 6  | c：字符设备文件（例如猫等串口设备）                               |             |
| 7  | s：套接口文件/数据接口文件（例如启动一个MySql服务器时会产生一个mysql.sock文件） |             |

#### 权限与功能

| 序号 | 文件类型 | linux系统文件权限                            | 资源类型        | saas系统的资源权限                |
|----|:-----|:---------------------------------------|:------------|:---------------------------|
|    | 文件   | r ： 可以读取文件内容(比如命令 cat more head tail). | menu: 模块/菜单 | show_flag: 模块是否可访问,即是否可以显示 |
|    |      | w ： 可以编辑文件(比如命令 vim echo ).            | button: 按钮  | show_falg: 按钮是否可以在此菜单下显示   |
|    |      | x ： 可以执行.                              | api: 请求接口   | access_falg: 接口是否可以在此菜单下请求 |
|    | 目录   | r：可以查询目录下的文件（比如命令ls  ll）。              |             |                            |
|    |      | w：具有修改目录结构的权限，比如新建文件和目录，               |             |                            |
|    |      | x：目录有执行权限但是不能运行，可以进入目录（cd命令）。          |             |                            |
|    |      |                                        |             |                            |

### saas系统资源表设计

概述:
系统中粒度最小的资源, 包含 按钮, api接口,

```sql

CREATE TABLE `liam_role`
(
    `role_id`          bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
    `role_code`        varchar(120) DEFAULT NULL COMMENT '角色编码',
    `parent_role_code` varchar(120) DEFAULT 'root' COMMENT '父级角色编码',
    `role_name`        varchar(120) DEFAULT NULL COMMENT '角色名称',
    `role_desc`        varchar(120) DEFAULT NULL COMMENT '角色描述',
    `ext_data`         text         DEFAULT NULL COMMENT '扩展数据',
    `tenant_id`        bigint(20) NOT NULL COMMENT '租户id',
    `version_num`      bigint(20)   DEFAULT '1' COMMENT '版本号',
    `created_by_user`  bigint(20)   DEFAULT '0' COMMENT '创建用户',
    `created_by_emp`   bigint(20)   DEFAULT '0' COMMENT '创建员工',
    `created_time`     datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_by_user`  bigint(20)   DEFAULT '0' COMMENT '最后更新用户',
    `updated_by_emp`   bigint(20)   DEFAULT '0' COMMENT '最后更新员工',
    `updated_time`     datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '最后更新时间',
    PRIMARY KEY (`role_id`) USING BTREE
) COMMENT ='角色表';

CREATE TABLE `liam_menu`
(
    `menu_id`          bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
    `menu_type`        varchar(120) DEFAULT NULL COMMENT '菜单类型',
    `menu_code`        varchar(120) DEFAULT NULL COMMENT '菜单编码',
    `parent_menu_code` varchar(120) DEFAULT 'root' COMMENT '父级菜单编码',
    `menu_name`        varchar(120) DEFAULT NULL COMMENT '菜单名称',
    `menu_desc`        varchar(120) DEFAULT NULL COMMENT '菜单描述',
    `interaction`      varchar(120) DEFAULT NULL COMMENT '交互类型',
    `url`              text         DEFAULT NULL COMMENT '路径',
    `icon`             varchar(120) DEFAULT NULL COMMENT '菜单图标',
    `ext_data`         text         DEFAULT NULL COMMENT '扩展数据',
    `tenant_id`        bigint(20) NOT NULL COMMENT '租户id',
    `version_num`      bigint(20)   DEFAULT '1' COMMENT '版本号',
    `created_by_user`  bigint(20)   DEFAULT '0' COMMENT '创建用户',
    `created_by_emp`   bigint(20)   DEFAULT '0' COMMENT '创建员工',
    `created_time`     datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_by_user`  bigint(20)   DEFAULT '0' COMMENT '最后更新用户',
    `updated_by_emp`   bigint(20)   DEFAULT '0' COMMENT '最后更新员工',
    `updated_time`     datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '最后更新时间',
    PRIMARY KEY (`menu_id`) USING BTREE
) COMMENT ='菜单表';

CREATE TABLE `liam_role_menu`
(
    `role_menu_id`    bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
    `role_code`       varchar(120) DEFAULT NULL COMMENT '角色编码',
    `menu_code`       varchar(120) DEFAULT NULL COMMENT '菜单编码',
    `ext_data`        text         DEFAULT NULL COMMENT '扩展数据',
    `tenant_id`       bigint(20) NOT NULL COMMENT '租户id',
    `version_num`     bigint(20)   DEFAULT '1' COMMENT '版本号',
    `created_by_user` bigint(20)   DEFAULT '0' COMMENT '创建用户',
    `created_by_emp`  bigint(20)   DEFAULT '0' COMMENT '创建员工',
    `created_time`    datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_by_user` bigint(20)   DEFAULT '0' COMMENT '最后更新用户',
    `updated_by_emp`  bigint(20)   DEFAULT '0' COMMENT '最后更新员工',
    `updated_time`    datetime     DEFAULT CURRENT_TIMESTAMP COMMENT '最后更新时间',
    PRIMARY KEY (`role_menu_id`) USING BTREE
) COMMENT ='角色与菜单关联表';


```

### 接口设计

### 常量定义

| 字段 | 值 | 含义 |
|----|:--|:---|
|    |   |    |

### 值定义

| 值说明 | key | value |
|-----|:----|:------|
|     |     |       |

### 备注

## 问题记录
